# PatchMetaState Actor Rule

## Overview

The PatchMetaState actor provides a demand-driven, cached map of patch metadata per mailing list. It fetches pages from the Lore API as needed, persists the cache to TOML, and supports cache invalidation and validation.

## Architecture
- Core: Handles state, cache, and message loop
- Message: Enum for all supported operations (get, get_slice, len, is_cache_valid, persist, load, invalidate)
- Public Interface: Async methods for all operations, with mock support

## Usage
- Use `get(list, index)` or `get_slice(list, range)` to fetch items; actor will fetch new pages as needed
- Use `len(list)` to get the number of cached items for a list
- Use `is_cache_valid(list)` to check if the cache is up-to-date for a list
- Use `persist_cache()` and `load_cache()` for persistence
- Use `invalidate_cache()` to clear the cache

## Best Practices
- Always use async methods
- Use demand-driven access for efficiency
- Persist cache before shutdown if needed
- Validate cache before using for critical operations
description:
globs:
alwaysApply: false
---
